(function(window,document){executeGoogleTagManager(window,document);setCookieHtmChannelReference(window,document);sendTrackingEvent(window);setFunctionRegister(window,document);createHotDataLayer(window)})(window,document);function executeGoogleTagManager(window,document){const dataGtmElement=document.querySelector('script[data-gtm-id^="GTM-"]');if(dataGtmElement){const gtmId=dataGtmElement.getAttribute("data-gtm-id");if(gtmId){window["dataLayer"]=window["dataLayer"]||[];window["dataLayer"].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});const f=document.getElementsByTagName("script")[0],j=document.createElement("script"),dl="dataLayer"!=="dataLayer"?"&l="+"dataLayer":"";j.async=true;j.src="https://www.googletagmanager.com/gtm.js?id="+gtmId+dl;f.parentNode.insertBefore(j,f);insertIframeGoogleTagManager(document,gtmId)}else{console.error("data-gtm-id not found. Please inform data-gtm-id")}}else{console.warn("dataGtmElement not found. Please inform dataGtmElement or use direct google tag manager")}}function insertIframeGoogleTagManager(document,gtmId){if(document&&document.body&&gtmId){let iframe=document.createElement("iframe");let noscript=document.createElement("noscript");iframe.src="data:text/html;charset=utf-8,"+encodeURI(`https://www.googletagmanager.com/ns.html?id=${gtmId}`);iframe.height="0";iframe.width="0";iframe.style={display:"none",visibility:"hidden"};noscript.appendChild(iframe);document.body.appendChild(noscript)}}function getTrackingReference(){return getCookie("htm_reference")??sessionStorage.getItem("htm_reference")??generateUUID()}function generateUUID(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16))}function setCookieHtmChannelReference(window,document){if(document.cookie){let htmReferenceCookie=getCookie("htm_reference");let reference=getTrackingReference();if(!htmReferenceCookie){document.cookie=`htm_reference=${reference};path=/;domain=${getDomain(window)};expires=${getExpireDate()}`}sessionStorage.setItem("htm_reference",reference)}}function getExpireDate(){let expiryDate=new Date;expiryDate.setMonth(expiryDate.getMonth()+1);return expiryDate.toUTCString()}function getDomain(window){if(window.location.hostname.includes("hotmart.com")){return".hotmart.com"}else if(window.location.hostname.includes("buildstaging.com")){return".buildstaging.com"}else{return window.location.hostname.trim()}}function setLastTrackingOrigin(window){localStorage.setItem("lastTrackingOrigin",window.origin)}function shouldSendTrackingEvent(window){return isProdEnv(window)&&window.origin!==localStorage.getItem("lastTrackingOrigin")&&getCookie("htm_reference")}function sendTrackingEvent(window){if(shouldSendTrackingEvent(window)){let reference=getCookie("htm_reference");fetch(getUrlTrackingApiEvent(window),{method:"POST",mode:"cors",cache:"no-cache",body:JSON.stringify({system:"api_htm",entity:"journey_tracking",action:"register",event_version:"1.1",data_version:"1.0",event:getJourneyTrackingEvent(reference)})}).then(response=>{setLastTrackingOrigin(window);console.log("Tracking event sent",response)}).catch(error=>{console.error("Error on send tracking event",error);sendTrackingEventApiHtm(window,reference)})}}function sendTrackingEventApiHtm(window,reference){fetch(getUrlJourneyTrackingEventApiHtm(window),{method:"PUT",mode:"cors",cache:"no-cache",body:JSON.stringify(getJourneyTrackingEvent(reference)),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(response=>{setLastTrackingOrigin(window);console.log("Tracking event api htm sent",response)}).catch(error=>console.error("Error on send tracking event api htm",error))}function isProdEnv(window){return getDomain(window).includes("hotmart.com")}function getUrlTrackingApiEvent(window){return isProdEnv(window)?"https://tracking-api.hotmart.com/rest/track/event/json":"https://tracking-api.buildstaging.com/rest/track/event/json"}function getUrlJourneyTrackingEventApiHtm(window){return isProdEnv(window)?"https://api-hotmart-tracking-manager.hotmart.com/api/v1/journeyTracking/sendEvent":"https://api-hotmart-tracking-manager.buildstaging.com/api/v1/journeyTracking/sendEvent"}function getUrlRegisterSignupApiHtm(window,userId){let htmReference=getCookie("htm_reference");return isProdEnv(window)?`https://api-hotmart-tracking-manager.hotmart.com/api/v2/signupRegister/register/${userId}/${htmReference}`:`https://api-hotmart-tracking-manager.buildstaging.com/api/v2/signupRegister/register/${userId}/${htmReference}`}function getJourneyTrackingEvent(reference){return{reference:reference,origin:getOrigin(window),user:getUserInformation(window),dateTime:new Date}}function getOrigin(window){let gtmChannelCookie=JSON.parse(getCookie("gtm_channel")??"{}");let urlParams=new URLSearchParams(window.location.search);return{location:{href:window.location.href,origin:window.location.origin,pathname:window.location.pathname,parameters:window.location.search,language:window.location.language},source:urlParams.get("utm_source")??gtmChannelCookie.source??"",medium:urlParams.get("utm_medium")??gtmChannelCookie.medium??"",campaign:urlParams.get("utm_campaign")??gtmChannelCookie.campaign??"",channel:urlParams.get("utm_channel")??gtmChannelCookie.channel??"",gclid:urlParams.get("gclid")??gtmChannelCookie.gclid??""}}function getUserInformation(window){return{hotmartId:getCookie("hmVlcIntegration")??"",googleId:getCookie("_ga")??getCookie("_gid")??"",navigator:{userAgent:window.navigator.userAgent,language:getCookie("hmLangCookie")??window.navigator.language},timezone:(new Date).getTimezoneOffset(),screen:{width:window.innerWidth,height:window.innerHeight}}}function setFunctionRegister(window,document){window.registerUserSignup=userId=>new Promise((resolve,reject)=>{registerUserSignupFn(window,document,userId).then(()=>{window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:"hotmart-tracking-signup"});resolve()}).catch(error=>reject(error))})}function getFlagUserRegisteredName(userId){return`userAlreadyRegistered_${userId}`}function removePreviousHotmartTrackingReference(window,document){deleteCookie(window,document,"htm_reference");sessionStorage.removeItem("htm_reference")}function isUserAlreadyRegistered(userId){return localStorage.getItem(getFlagUserRegisteredName(userId))==="true"}function registerUserSignupFn(window,document,userId){return new Promise((resolve,reject)=>{if(isProdEnv(window)&&!isUserAlreadyRegistered(userId)){fetch(getUrlRegisterSignupApiHtm(window,userId),{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-type":"application/json; charset=UTF-8"}}).then(response=>{if(response&&response.ok){localStorage.setItem(getFlagUserRegisteredName(userId),String(true));removePreviousHotmartTrackingReference(window,document);console.log("Register signup sent",response);resolve()}else{fallbackRegisterUserSignupFailed(window,`Response signup not ok [${response}]`,userId).then(()=>resolve()).catch(error=>reject(error))}}).catch(error=>{fallbackRegisterUserSignupFailed(window,error,userId).then(()=>resolve()).catch(error=>reject(error))})}resolve()})}function fallbackRegisterUserSignupFailed(window,error,userId){return new Promise((resolve,reject)=>{console.error("Error on register signup api htm",error);if(isProdEnv(window)){fetch(getUrlTrackingApiEvent(window),{method:"POST",mode:"cors",cache:"no-cache",body:JSON.stringify({system:"api_htm",entity:"signup",action:"solicitation",event_version:"1.1",data_version:"1.0",event:{hotmartId:userId,htmReference:getCookie("htm_reference")}})}).then(response=>{if(response&&response.ok){localStorage.setItem(getFlagUserRegisteredName(userId),String(true));removePreviousHotmartTrackingReference(window,document);console.log("Register solicitation signup sent",response);resolve()}}).catch(error=>{console.error("Error on register solicitation signup",error);reject(error)})}resolve()})}function getCookie(cookieName){let cookie={};document.cookie.split(";").forEach(function(el){let[key,value]=el.split("=");cookie[key.trim()]=value});return cookie[cookieName]}function deleteCookie(window,document,cookieName){if(document.cookie){document.cookie=`${cookieName}='';path=/;domain=${isProdEnv(window)?".hotmart.com":".buildstaging.com"};expires=${(new Date).toUTCString()}`}}function createHotDataLayer(window){processHotDataLayerPreviousSignup(window);window.hotDataLayer=new Proxy([],{set:(obj,prop,value)=>{if(prop!=="length"){let setResponse=Reflect.set(obj,prop,value);const pushEvent=new CustomEvent("hotDatalayerPush",{detail:value});window.dispatchEvent(pushEvent);return setResponse}return Reflect.set(obj,prop,value)}});window.addEventListener("hotDatalayerPush",()=>{processHotDataLayerPreviousSignup(window)})}function processHotDataLayerPreviousSignup(window){window.hotDataLayer=window.hotDataLayer||[];if(window&&window.hotDataLayer&&Array.isArray(window.hotDataLayer)){window.hotDataLayer.forEach((event,index,hotDataLayer)=>{if("registerUserSignup"===event.type&&event["userId"]){window.registerUserSignup(event["userId"]).then(()=>hotDataLayer.slice(index,1)).catch(error=>console.error("Error on processHotDataLayerPreviousSignup",error))}})}}